# I²C

## I²C란?
- **Inter-Integrated Circuit**의 약자.
- **동기 직렬 통신**: **마스터 클럭(SCL)** 신호에 맞추어 데이터를 **전송(SDA)**.
- 기본 배선: **SCL(클럭)**, **SDA(데이터)** 2선만으로 통신. (공유 그라운드 필요)
- **반이중 통신(Half-Duplex)**: SDA 라인 하나로 송/수신 모두 처리 (멀티마스터 환경 지원).
    - 한 번에 한 방향만 전송하며, 방향 전환은 R/W 비트 + Repeated START로.
- 멀티드롭 구조 (다대다 네트워크): 여러 마스터–슬레이브 간 연결 가능, 각 디바이스는 독립적인 7비트 또는 10비트 주소를 가짐.
- 풀업 저항 필수: SDA, SCL은 오픈드레인(OD) 구조로, 반드시 외부 풀업저항으로 HIGH 유지.

---

## 신호와 프레임 구조

```text
Bus Idle: SCL=H, SDA=H

S   Addr[6:0]  R/W  ACK   Data[7:0]  ACK   ...   Data[7:0]  NACK   P
|     7bit       1    1       8        1                  1        |
START                                                     STOP
```

- **Idle**: SDA와 SCL 모두 HIGH.
- **START(S)**: SCL HIGH일 때 SDA가 HIGH→LOW로 떨어질때.
- **STOP(P)**: SCL HIGH일 때 SDA가 LOW→HIGH로 올라갈때.
- **Address + R/W**: 7bit(기본) 또는 10bit 주소. 뒤에 R/W 비트(Write=0, Read=1) 붙임.
- **ACK/NACK**: 각 바이트(8비트) 전송 후, 수신 측이 9번째 클럭에서 SDA를 LOW=ACK, HIGH=NACK로 응답.
- **Data**: 실제 데이터(8비트 단위 전송). 다중 바이트 연속 전송 가능.
- **Repeated START(Sr)**: STOP 없이 바로 다음 트랜잭션으로 넘어갈 때 사용(읽기 전환 등에 흔함).
- 비트 유효 구간: SCL이 HIGH일 때 데이터는 안정적이어야 하며, SCL이 LOW일 때만 데이터 전이가 허용.

## 주소 체계 (7-bit / 10-bit)
- 7-bit 주소가 일반적(0x03~0x77 사용 가능 범위가 많음).
- 10-bit 주소는 드묾(프리픽스 11110xx로 시작하는 특별 시퀀스).
- 주의(8비트 표기 혼동): 데이터시트가 8비트 주소(R/W 포함)로 표기하는 경우가 있음.
    - 7-bit 주소 A7를 8비트로 쓰려면 (A7 << 1) | R/W.
- 일부 주소는 예약(예: 0x00 General Call 등).

---

## 핵심 설정
- 클럭 속도(모드별)
    - Standard: 100 kHz
    - Fast: 400 kHz
    - Fast Plus: 1 MHz
    - High Speed: 3.4 MHz
    - Ultra Fast: 5 MHz (드물게 사용, 마스터→슬레이브 단방향 쓰기 전용)
- 주소 길이: 7비트(0~127, 실제 사용 가능 범위 112개 정도) / 10비트 확장.
- 풀업 저항
    - 오픈드레인이라 Rpull-up가 필수. 일반적으로
        - 100 kHz: 4.7 kΩ 근처,
        - 400 kHz: 2.2 kΩ ~ 3.3 kΩ 근처가 출발점.
    - 엄밀히는 버스 정전용량 Cbus와 상승시간(t_r) 제약으로 계산(대략 R ≤ t_r / (0.8473·Cbus))하고, 슬레이브가 싱크할 **전류 사양(I_OL)**을 넘지 않도록 선택.
- 버스 전압/레벨 시프팅: 5 V ↔ 3.3 V 혼재 시 MOSFET형 양방향 레벨시프터 사용 권장.
- 멀티마스터: 여러 마스터가 동시에 동작할 수 있으며, 버스 충돌 시 임의의 마스터가 우선권을 잃고 대기(Arbitration).
    - SDA 선에서 ‘0’이 ‘1’을 이기는 중재(arbitration)로 충돌을 해결

--- 

## 버스 토폴로지/배선 팁
- 데이지체인 형태가 이상적. 스타 토폴로지나 긴 스텁은 링잉/용량 증가로 문제 유발.
- I²C는 **근거리(수 십 cm 내외)**용. 길어지면 속도를 낮추거나 버스 익스텐더/디퍼런셜 I²C 트랜시버(예: PCA96xx 계열) 고려.
- 그라운드 리턴이 중요. 가능하면 **트위스티드 페어(SDA-GND, SCL-GND)**로 잡음 내성 강화.
- **정전용량 합계(Cbus)**는 표준에서 제한(일반적으로 400 pF 근처). 디바이스 수/배선 길이에 주의.

---

## I²C 주요 사용처
- 센서 인터페이스: 가속도계, 자이로, 온도, 압력 센서, ToF/거리 등.
- EEPROM / RTC / ADC / DAC: 저속 주변장치 메모리/시간/변환 모듈 접근.
- MCU ↔ MCU 간 저속 제어 신호나 설정 전달.
- 디스플레이/입력 장치: LCD, OLED, 키패드, 터치 IC.
- 전력 관리: PMIC, 배터리 모니터, 팬 컨트롤러.
- SoC 내부 버스: 온보드 칩 간 제어 채널.

## 장/단점
| 구분 | 내용
|:---:|:---
| 장점 | - 배선 단순 (2선 + GND).<br>- 2선 + 주소화로 다슬레이브 연결 쉬움.<br>- 하드웨어 자원 소비 적음.<br>- 저전력·저비용 디바이스에 적합.
| 단점 | - 반이중 + 상대적으로 저속(SPI 대비)<br>- 풀업저항/배선 길이에 제약(전기적 부하에 민감).<br>- 오픈드레인 특성상 에지 완만→ 고속/장거리 불리<br>- 슬레이브 오동작 시 버스 헹업 가능(복구 설계 필요)

--- 

## 비동기 vs 동기 통신 (UART vs I²C vs SPI)
- **UART**(비동기): 클럭 없이 Start/Stop 비트로 동기화, 1:1 통신.
- **I²C**(동기, 멀티마스터/슬레이브): 2선, 주소 기반 멀티드롭 네트워크. 저속·저전력 주변기기 제어에 특화.
- **SPI**(동기, 고속, 전이중): 클럭 + MISO/MOSI/CS 라인 다수 필요, 속도 빠르고 단일 보드 내 고성능 통신에 적합.

## 비교표
| 항목 | UART | I²C | SPI
|:---|:---:|:---:|:---:
| 기본구조 | 비동기(클럭 없음) | 동기(클럭 있음, SCL) | 동기(클럭 있음, SCLK)
| 신호/배선 | TX, RX(+GND). 필요시 RTS/CTS | SCL(클럭), SDA(데이터)(+GND) | SCK, MOSI, MISO, CS(+GND)
| 통신방식 | 1:1 Point-to-Point | 다수 마스터·슬레이브(멀티드롭) | 마스터 1 : 슬레이브 N
| Duplex | 전이중 Full-duplex | 반이중 Half-duplex | 전이중 Full-duplex
| 주소/프레이밍 | 주소 개념 없음(상위 프로토콜) | 7/10비트 주소, ACK/NACK | 주소 없음, CS로 슬레이브 선택
| 속도 | 수 kbps ~ 수 Mbps(일반 TTL) | 100k/400k/1M/3.4M(일반) | 수 MHz ~ 수십 MHz(보드 내)
| 전송거리 | 길다(수 m~수십 m) | 짧다(수십 cm~수 m) | 매우 짧다(수십 cm 내외)
| 멀티슬레이브 | 불가능 | 쉬움 | 복잡함 (CS 핀 x 슬레이브 수)
| 대표 용도 | 디버그 콘솔, 모뎀/모듈 제어, PC-칩, 부트로더 | 센서·EEPROM·디스플레이 저속 제어 | 플래시/SD, 디스플레이, 고속 센서/ADC, 스트리밍